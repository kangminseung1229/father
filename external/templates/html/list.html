<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>


<style>

    td.grey{
        color : grey;
    }
    td.red{
        color : red;
    }
</style>
</head>

<header th:replace="fragments/cm_top.html :: header('메모')"></header>

<body>
    
    <table class="table">
        <thead>
            <tr>
                <th scope="col">날짜</th>
                <th scope="col">금액</th>
                <th scope="col">저장</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each=" row : ${list}">
                <td th:text="${#temporals.format(row.datememo,'yyyy-MM-dd')}" >2020-11-11</td>
                <td><input type="text" th:value="${#numbers.formatInteger(row.price, 0, 'COMMA')}"name="price" th:id="'price' + ${row.id}" ></td>
                <td><button th:onclick="|save(${row.id});|">V</button></td>
            </tr>
            <tr>
                <th colspan="3">합계 :: <span th:text="${#numbers.formatInteger(monthTotal, 0, 'COMMA')}">total</span> 원</th>
            </tr>
        </tbody>
    </table>
</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>

    $(document).ready(function () {

        var target='';

        $("input[name='price']").focusout(function(){
           $(this).val(priceToString($(this).val())); 
        });

        $("input[name='price']").focus(function(){

            $(this).val('');
           $(this).val(priceToString($(this).val())); 
        });
    });
    
    function save(param) {

        var price = $("#price" + param).val()

        $.ajax({
            type: "post",
            url: "/priceSave",
            data: {price : price, id : param },
            dataType: "text",
            success: function (response) {
                console.log(response);
                alert('저장 완료');
            },error : function (e) { 
                console.log(e);
              }
        });
        
      }

      	//천단위 콤마
	function priceToString(price) {
	    return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }


</script>